{"version":3,"sources":["aurelia-spinner.js","../src/aurelia-spinner.ts"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","exports","value","aurelia_framework_1","require","aurelia_pal_1","blockClass","SpinnerCustomAttribute","element","container","viewEngine","spinnerView","show","view","block","prototype","attached","createSpinner","showChanged","showSpinner","classList","add","remove","_this","loadViewFactory","then","factory","childContainer","createChild","create","bind","addElement","removeSpinner","DOM","querySelectorAll","id","removeChild","divElement","spinnerDivElement","createElement","appendNodesTo","firstElementChild","setElementStyle","insertBefore","firstChild","htmlElement","elementRect","getBoundingClientRect","height","top","window","innerHeight","scrollY","style","position","zIndex","left","bindable","defaultBindingMode","bindingMode","oneWay","oneTime","autoinject"],"mappings":"AAAA;;;;AACA,IAAIA,aAAc,aAAQ,UAAKA,UAAd,IAA6B,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACnF,QAAIC,IAAIC,UAAUC,MAAlB;AAAA,QAA0BC,IAAIH,IAAI,CAAJ,GAAQH,MAAR,GAAiBE,SAAS,IAAT,GAAgBA,OAAOK,OAAOC,wBAAP,CAAgCR,MAAhC,EAAwCC,GAAxC,CAAvB,GAAsEC,IAArH;AAAA,QAA2HO,CAA3H;AACA,QAAI,QAAOC,OAAP,yCAAOA,OAAP,OAAmB,QAAnB,IAA+B,OAAOA,QAAQC,QAAf,KAA4B,UAA/D,EAA2EL,IAAII,QAAQC,QAAR,CAAiBZ,UAAjB,EAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,CAAJ,CAA3E,KACK,KAAK,IAAIU,IAAIb,WAAWM,MAAX,GAAoB,CAAjC,EAAoCO,KAAK,CAAzC,EAA4CA,GAA5C;AAAiD,YAAIH,IAAIV,WAAWa,CAAX,CAAR,EAAuBN,IAAI,CAACH,IAAI,CAAJ,GAAQM,EAAEH,CAAF,CAAR,GAAeH,IAAI,CAAJ,GAAQM,EAAET,MAAF,EAAUC,GAAV,EAAeK,CAAf,CAAR,GAA4BG,EAAET,MAAF,EAAUC,GAAV,CAA5C,KAA+DK,CAAnE;AAAxE,KACL,OAAOH,IAAI,CAAJ,IAASG,CAAT,IAAcC,OAAOM,cAAP,CAAsBb,MAAtB,EAA8BC,GAA9B,EAAmCK,CAAnC,CAAd,EAAqDA,CAA5D;AACH,CALD;AAMAC,OAAOM,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEC,OAAO,IAAT,EAA7C;ACPA,IAAAC,sBAAAC,QAAA,mBAAA,CAAA;AACA,IAAAC,gBAAAD,QAAA,aAAA,CAAA;AAEA,IAAME,aAAa,iBAAnB;AAGA,IAAAC,yBAAA,YAAA;AASE,aAAAA,sBAAA,CAAoBC,OAApB,EAA8CC,SAA9C,EAA4EC,UAA5E,EAAkG;AAA9E,aAAAF,OAAA,GAAAA,OAAA;AAA0B,aAAAC,SAAA,GAAAA,SAAA;AAA8B,aAAAC,UAAA,GAAAA,UAAA;AANpE,aAAAC,WAAA,GAAsB,wBAAtB;AAE8C,aAAAC,IAAA,GAAgB,KAAhB;AACC,aAAAC,IAAA,GAAe,KAAKF,WAApB;AACA,aAAAG,KAAA,GAAiB,IAAjB;AAEgD;AAEvGP,2BAAAQ,SAAA,CAAAC,QAAA,GAAA,YAAA;AACE,aAAKC,aAAL;AACD,KAFD;AAIAV,2BAAAQ,SAAA,CAAAG,WAAA,GAAA,UAAYC,WAAZ,EAAgC;AAC9B,YAAI,CAAC,KAAKhC,MAAV,EAAkB;AAElBgC,sBAAc,KAAKhC,MAAL,CAAYiC,SAAZ,CAAsBC,GAAtB,CAA0Bf,UAA1B,CAAd,GAAsD,KAAKnB,MAAL,CAAYiC,SAAZ,CAAsBE,MAAtB,CAA6BhB,UAA7B,CAAtD;AACD,KAJD;AAMQC,2BAAAQ,SAAA,CAAAE,aAAA,GAAR,YAAA;AAAA,YAAAM,QAAA,IAAA;AACE,aAAKb,UAAL,CAAgBc,eAAhB,CAAgC,KAAKX,IAArC,EAA2CY,IAA3C,CAAgD,UAAAC,OAAA,EAAO;AACrD,gBAAMC,iBAAiBJ,MAAKd,SAAL,CAAemB,WAAf,EAAvB;AACA,gBAAMf,OAAOa,QAAQG,MAAR,CAAeF,cAAf,CAAb;AACAd,iBAAKiB,IAAL,CAAUP,KAAV;AAEAA,kBAAKQ,UAAL,CAAgBlB,IAAhB;AACD,SAND;AAOD,KARO;AAUAN,2BAAAQ,SAAA,CAAAiB,aAAA,GAAR,YAAA;AACE,YAAMA,gBAAgB3B,cAAA4B,GAAA,CAAIC,gBAAJ,CAAqB,MAAI,KAAK1B,OAAL,CAAa2B,EAAtC,EAA4C,CAA5C,CAAtB;AACAH,sBAAcI,WAAd,CAA0B,KAAKC,UAA/B;AACD,KAHO;AAKA9B,2BAAAQ,SAAA,CAAAgB,UAAA,GAAR,UAAmBlB,IAAnB,EAA6B;AAC3B,YAAMJ,YAAYJ,cAAA4B,GAAA,CAAIC,gBAAJ,CAAqB,MAAI,KAAK1B,OAAL,CAAa2B,EAAtC,EAA4C,CAA5C,CAAlB;AAEA,YAAMG,oBAAiCjC,cAAA4B,GAAA,CAAIM,aAAJ,CAAkB,KAAlB,CAAvC;AACA1B,aAAK2B,aAAL,CAAmBF,iBAAnB;AAEA,aAAKnD,MAAL,GAAc,KAAKqB,OAAL,CAAaiC,iBAAb,IAAkC,KAAKjC,OAArD;AAEA,aAAK6B,UAAL,GAAkB,KAAKK,eAAL,CAAqB,KAAKlC,OAA1B,EAAmC8B,iBAAnC,CAAlB;AAEA,YAAI,KAAKxB,KAAT,EAAgB,KAAK3B,MAAL,CAAYiC,SAAZ,CAAsBC,GAAtB,CAA0Bf,UAA1B;AAEhBG,kBAAUkC,YAAV,CAAuB,KAAKN,UAA5B,EAAwC5B,UAAUmC,UAAlD;AACD,KAbO;;AAgBArC,2BAAAQ,SAAA,CAAA2B,eAAA,GAAR,UAAwBlC,OAAxB,EAA0CqC,WAA1C,EAAkE;AAChE,YAAMC,cAActC,QAAQuC,qBAAR,EAApB;AACA,YAAMC,SAASH,YAAYE,qBAAZ,GAAoCC,MAAnD;AACA,YAAIC,MAAMH,YAAYG,GAAZ,GAAkBH,YAAYE,MAAxC;AAEAC,cAAQA,MAAMD,MAAP,GAAiBE,OAAOC,WAAzB,GAAwCF,MAAMC,OAAOE,OAArD,GAAgEN,YAAYG,GAAZ,GAAkBD,MAAlB,GAA2BE,OAAOE,OAAxG;AAEAP,oBAAYQ,KAAZ,CAAkBC,QAAlB,GAA6B,UAA7B;AACAT,oBAAYQ,KAAZ,CAAkBE,MAAlB,GAA2B,KAA3B;AACAV,oBAAYQ,KAAZ,CAAkBL,MAAlB,GAA2B,iBAAeC,GAAf,GAAkB,KAA7C;AACAJ,oBAAYQ,KAAZ,CAAkBJ,GAAlB,GAA2BA,MAAG,IAA9B;AACAJ,oBAAYQ,KAAZ,CAAkBG,IAAlB,GAAyB,kBAAzB;AAEA,eAAOX,WAAP;AACD,KAdO;AA/C8C5D,eAAA,CAArDkB,oBAAAsD,QAAA,CAAS,EAAEC,oBAAoBvD,oBAAAwD,WAAA,CAAYC,MAAlC,EAAT,CAAqD,CAAA,EDwDjDrD,uBAAuBQ,SCxD0B,EDwDf,MCxDe,EDwDP,KAAK,CCxDE;AACC9B,eAAA,CAAtDkB,oBAAAsD,QAAA,CAAS,EAAEC,oBAAoBvD,oBAAAwD,WAAA,CAAYE,OAAlC,EAAT,CAAsD,CAAA,ED0DlDtD,uBAAuBQ,SC1D2B,ED0DhB,MC1DgB,ED0DR,KAAK,CC1DG;AACA9B,eAAA,CAAtDkB,oBAAAsD,QAAA,CAAS,EAAEC,oBAAoBvD,oBAAAwD,WAAA,CAAYE,OAAlC,EAAT,CAAsD,CAAA,ED4DlDtD,uBAAuBQ,SC5D2B,ED4DhB,OC5DgB,ED4DP,KAAK,CC5DE;AAP5CR,6BAAsBtB,WAAA,CADlCkB,oBAAA2D,UACkC,CAAA,EAAtBvD,sBAAsB,CAAtB;AAoEb,WAAAA,sBAAA;AApEA,CAAA,EAAA;AAAaN,QAAAM,sBAAA,GAAAA,sBAAA","file":"aurelia-spinner.js","sourceRoot":"/source/","sourcesContent":["\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar aurelia_framework_1 = require(\"aurelia-framework\");\nvar aurelia_pal_1 = require(\"aurelia-pal\");\nvar blockClass = 'spinner-blocker';\nvar SpinnerCustomAttribute = (function () {\n    function SpinnerCustomAttribute(element, container, viewEngine) {\n        this.element = element;\n        this.container = container;\n        this.viewEngine = viewEngine;\n        this.spinnerView = './aurelia-spinner.html';\n        this.show = false;\n        this.view = this.spinnerView;\n        this.block = true;\n    }\n    SpinnerCustomAttribute.prototype.attached = function () {\n        this.createSpinner();\n    };\n    SpinnerCustomAttribute.prototype.showChanged = function (showSpinner) {\n        if (!this.target)\n            return;\n        showSpinner ? this.target.classList.add(blockClass) : this.target.classList.remove(blockClass);\n    };\n    SpinnerCustomAttribute.prototype.createSpinner = function () {\n        var _this = this;\n        this.viewEngine.loadViewFactory(this.view).then(function (factory) {\n            var childContainer = _this.container.createChild();\n            var view = factory.create(childContainer);\n            view.bind(_this);\n            _this.addElement(view);\n        });\n    };\n    SpinnerCustomAttribute.prototype.removeSpinner = function () {\n        var removeSpinner = aurelia_pal_1.DOM.querySelectorAll(\"#\" + this.element.id)[0];\n        removeSpinner.removeChild(this.divElement);\n    };\n    SpinnerCustomAttribute.prototype.addElement = function (view) {\n        var container = aurelia_pal_1.DOM.querySelectorAll(\"#\" + this.element.id)[0];\n        var spinnerDivElement = aurelia_pal_1.DOM.createElement('div');\n        view.appendNodesTo(spinnerDivElement);\n        this.target = this.element.firstElementChild || this.element;\n        this.divElement = this.setElementStyle(this.element, spinnerDivElement);\n        if (this.block)\n            this.target.classList.add(blockClass);\n        container.insertBefore(this.divElement, container.firstChild);\n    };\n    // todo fix too recalculate element height\n    SpinnerCustomAttribute.prototype.setElementStyle = function (element, htmlElement) {\n        var elementRect = element.getBoundingClientRect();\n        var height = htmlElement.getBoundingClientRect().height;\n        var top = elementRect.top + elementRect.height;\n        top = ((top + height) < window.innerHeight) ? top + window.scrollY : (elementRect.top - height + window.scrollY);\n        htmlElement.style.position = 'absolute';\n        htmlElement.style.zIndex = '999';\n        htmlElement.style.height = \"calc(100% - \" + top + \"px)\";\n        htmlElement.style.top = top + \"px\";\n        htmlElement.style.left = \"calc(50% - 35px)\";\n        return htmlElement;\n    };\n    __decorate([\n        aurelia_framework_1.bindable({ defaultBindingMode: aurelia_framework_1.bindingMode.oneWay })\n    ], SpinnerCustomAttribute.prototype, \"show\", void 0);\n    __decorate([\n        aurelia_framework_1.bindable({ defaultBindingMode: aurelia_framework_1.bindingMode.oneTime })\n    ], SpinnerCustomAttribute.prototype, \"view\", void 0);\n    __decorate([\n        aurelia_framework_1.bindable({ defaultBindingMode: aurelia_framework_1.bindingMode.oneTime })\n    ], SpinnerCustomAttribute.prototype, \"block\", void 0);\n    SpinnerCustomAttribute = __decorate([\n        aurelia_framework_1.autoinject\n    ], SpinnerCustomAttribute);\n    return SpinnerCustomAttribute;\n}());\nexports.SpinnerCustomAttribute = SpinnerCustomAttribute;\n","import { autoinject, bindable, bindingMode, Container, View, ViewEngine } from 'aurelia-framework';\r\nimport { DOM } from 'aurelia-pal';\r\n\r\nconst blockClass = 'spinner-blocker';\r\n\r\n@autoinject\r\nexport class SpinnerCustomAttribute {\r\n  private divElement: HTMLElement;\r\n  private target: Element;\r\n  private spinnerView: string = './aurelia-spinner.html';\r\n\r\n  @bindable({ defaultBindingMode: bindingMode.oneWay }) show: boolean = false;\r\n  @bindable({ defaultBindingMode: bindingMode.oneTime }) view: string = this.spinnerView;\r\n  @bindable({ defaultBindingMode: bindingMode.oneTime }) block: boolean = true;\r\n\r\n  constructor(private element: Element, private container: Container, private viewEngine: ViewEngine) { }\r\n\r\n  attached() {\r\n    this.createSpinner();\r\n  }\r\n\r\n  showChanged(showSpinner: boolean) {\r\n    if (!this.target) return;\r\n\r\n    showSpinner ? this.target.classList.add(blockClass) : this.target.classList.remove(blockClass);\r\n  }\r\n\r\n  private createSpinner() {\r\n    this.viewEngine.loadViewFactory(this.view).then(factory => {\r\n      const childContainer = this.container.createChild();\r\n      const view = factory.create(childContainer);\r\n      view.bind(this);\r\n\r\n      this.addElement(view);\r\n    });\r\n  }\r\n\r\n  private removeSpinner() {\r\n    const removeSpinner = DOM.querySelectorAll(`#${this.element.id}`)[0];\r\n    removeSpinner.removeChild(this.divElement);\r\n  }\r\n\r\n  private addElement(view: View) {\r\n    const container = DOM.querySelectorAll(`#${this.element.id}`)[0];\r\n\r\n    const spinnerDivElement = <HTMLElement>DOM.createElement('div');\r\n    view.appendNodesTo(spinnerDivElement);\r\n\r\n    this.target = this.element.firstElementChild || this.element;\r\n\r\n    this.divElement = this.setElementStyle(this.element, spinnerDivElement);\r\n\r\n    if (this.block) this.target.classList.add(blockClass);\r\n\r\n    container.insertBefore(this.divElement, container.firstChild);\r\n  }\r\n\r\n  // todo fix too recalculate element height\r\n  private setElementStyle(element: Element, htmlElement: HTMLElement): HTMLElement{\r\n    const elementRect = element.getBoundingClientRect();\r\n    const height = htmlElement.getBoundingClientRect().height;\r\n    let top = elementRect.top + elementRect.height;\r\n\r\n    top = ((top + height) < window.innerHeight) ? top + window.scrollY : (elementRect.top - height + window.scrollY);\r\n\r\n    htmlElement.style.position = 'absolute';\r\n    htmlElement.style.zIndex = '999';\r\n    htmlElement.style.height = `calc(100% - ${top}px)`;\r\n    htmlElement.style.top = `${top}px`;\r\n    htmlElement.style.left = `calc(50% - 35px)`;\r\n\r\n    return htmlElement;\r\n  }\r\n\r\n}\r\n"]}