{"version":3,"sources":["../src/aurelia-spinner.ts"],"names":[],"mappings":";;;;;;;;AAAA,uDAAmG;AACnG,2CAAkC;AAElC,IAAM,UAAU,GAAG,iBAAiB,CAAC;AAGrC;IASE,gCAAoB,OAAgB,EAAU,SAAoB,EAAU,UAAsB;QAA9E,YAAO,GAAP,OAAO,CAAS;QAAU,cAAS,GAAT,SAAS,CAAW;QAAU,eAAU,GAAV,UAAU,CAAY;QAN1F,gBAAW,GAAW,wBAAwB,CAAC;QAED,SAAI,GAAY,KAAK,CAAC;QACrB,SAAI,GAAW,IAAI,CAAC,WAAW,CAAC;QAChC,UAAK,GAAY,IAAI,CAAC;IAEyB,CAAC;IAEvG,yCAAQ,GAAR;QACE,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED,4CAAW,GAAX,UAAY,WAAoB;QAC9B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC;YAAC,MAAM,CAAC;QAEzB,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;IACjG,CAAC;IAEO,8CAAa,GAArB;QAAA,iBAQC;QAPC,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAA,OAAO;YACrD,IAAM,cAAc,GAAG,KAAI,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC;YACpD,IAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;YAC5C,IAAI,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;YAEhB,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACxB,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,8CAAa,GAArB;QACE,IAAM,aAAa,GAAG,iBAAG,CAAC,gBAAgB,CAAC,MAAI,IAAI,CAAC,OAAO,CAAC,EAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QACrE,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAC7C,CAAC;IAEO,2CAAU,GAAlB,UAAmB,IAAU;QAC3B,IAAM,SAAS,GAAG,iBAAG,CAAC,gBAAgB,CAAC,MAAI,IAAI,CAAC,OAAO,CAAC,EAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QAEjE,IAAM,iBAAiB,GAAgB,iBAAG,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAChE,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;QAEtC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,iBAAiB,IAAI,IAAI,CAAC,OAAO,CAAC;QAE7D,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,EAAE,iBAAiB,CAAC,CAAC;QAExE,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;YAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAEtD,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,EAAE,SAAS,CAAC,UAAU,CAAC,CAAC;IAChE,CAAC;IAED,0CAA0C;IAClC,gDAAe,GAAvB,UAAwB,OAAgB,EAAE,WAAwB;QAChE,IAAM,WAAW,GAAG,OAAO,CAAC,qBAAqB,EAAE,CAAC;QACpD,IAAM,MAAM,GAAG,WAAW,CAAC,qBAAqB,EAAE,CAAC,MAAM,CAAC;QAC1D,IAAI,GAAG,GAAG,WAAW,CAAC,GAAG,GAAG,WAAW,CAAC,MAAM,CAAC;QAE/C,GAAG,GAAG,CAAC,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,MAAM,CAAC,WAAW,CAAC,GAAG,GAAG,GAAG,MAAM,CAAC,OAAO,GAAG,CAAC,WAAW,CAAC,GAAG,GAAG,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;QAEjH,WAAW,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;QACxC,WAAW,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;QACjC,WAAW,CAAC,KAAK,CAAC,MAAM,GAAG,iBAAe,GAAG,QAAK,CAAC;QACnD,WAAW,CAAC,KAAK,CAAC,GAAG,GAAM,GAAG,OAAI,CAAC;QACnC,WAAW,CAAC,KAAK,CAAC,IAAI,GAAG,kBAAkB,CAAC;QAE5C,MAAM,CAAC,WAAW,CAAC;IACrB,CAAC;IA7DqD;QAArD,4BAAQ,CAAC,EAAE,kBAAkB,EAAE,+BAAW,CAAC,MAAM,EAAE,CAAC;wDAAuB;IACrB;QAAtD,4BAAQ,CAAC,EAAE,kBAAkB,EAAE,+BAAW,CAAC,OAAO,EAAE,CAAC;wDAAiC;IAChC;QAAtD,4BAAQ,CAAC,EAAE,kBAAkB,EAAE,+BAAW,CAAC,OAAO,EAAE,CAAC;yDAAuB;IAPlE,sBAAsB;QADlC,8BAAU;OACE,sBAAsB,CAoElC;IAAD,6BAAC;CApED,AAoEC,IAAA;AApEY,wDAAsB","file":"aurelia-spinner.js","sourcesContent":["import { autoinject, bindable, bindingMode, Container, View, ViewEngine } from 'aurelia-framework';\r\nimport { DOM } from 'aurelia-pal';\r\n\r\nconst blockClass = 'spinner-blocker';\r\n\r\n@autoinject\r\nexport class SpinnerCustomAttribute {\r\n  private divElement: HTMLElement;\r\n  private target: Element;\r\n  private spinnerView: string = './aurelia-spinner.html';\r\n\r\n  @bindable({ defaultBindingMode: bindingMode.oneWay }) show: boolean = false;\r\n  @bindable({ defaultBindingMode: bindingMode.oneTime }) view: string = this.spinnerView;\r\n  @bindable({ defaultBindingMode: bindingMode.oneTime }) block: boolean = true;\r\n\r\n  constructor(private element: Element, private container: Container, private viewEngine: ViewEngine) { }\r\n\r\n  attached() {\r\n    this.createSpinner();\r\n  }\r\n\r\n  showChanged(showSpinner: boolean) {\r\n    if (!this.target) return;\r\n\r\n    showSpinner ? this.target.classList.add(blockClass) : this.target.classList.remove(blockClass);\r\n  }\r\n\r\n  private createSpinner() {\r\n    this.viewEngine.loadViewFactory(this.view).then(factory => {\r\n      const childContainer = this.container.createChild();\r\n      const view = factory.create(childContainer);\r\n      view.bind(this);\r\n\r\n      this.addElement(view);\r\n    });\r\n  }\r\n\r\n  private removeSpinner() {\r\n    const removeSpinner = DOM.querySelectorAll(`#${this.element.id}`)[0];\r\n    removeSpinner.removeChild(this.divElement);\r\n  }\r\n\r\n  private addElement(view: View) {\r\n    const container = DOM.querySelectorAll(`#${this.element.id}`)[0];\r\n\r\n    const spinnerDivElement = <HTMLElement>DOM.createElement('div');\r\n    view.appendNodesTo(spinnerDivElement);\r\n\r\n    this.target = this.element.firstElementChild || this.element;\r\n\r\n    this.divElement = this.setElementStyle(this.element, spinnerDivElement);\r\n\r\n    if (this.block) this.target.classList.add(blockClass);\r\n\r\n    container.insertBefore(this.divElement, container.firstChild);\r\n  }\r\n\r\n  // todo fix too recalculate element height\r\n  private setElementStyle(element: Element, htmlElement: HTMLElement): HTMLElement{\r\n    const elementRect = element.getBoundingClientRect();\r\n    const height = htmlElement.getBoundingClientRect().height;\r\n    let top = elementRect.top + elementRect.height;\r\n\r\n    top = ((top + height) < window.innerHeight) ? top + window.scrollY : (elementRect.top - height + window.scrollY);\r\n\r\n    htmlElement.style.position = 'absolute';\r\n    htmlElement.style.zIndex = '999';\r\n    htmlElement.style.height = `calc(100% - ${top}px)`;\r\n    htmlElement.style.top = `${top}px`;\r\n    htmlElement.style.left = `calc(50% - 35px)`;\r\n\r\n    return htmlElement;\r\n  }\r\n\r\n}\r\n"],"sourceRoot":"/source/"}